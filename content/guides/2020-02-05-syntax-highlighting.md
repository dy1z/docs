---
title: "How to add syntax highlighting to HTML emails"
slug: "syntax-highlight-code-html-emails"
description: "Using PrismJS, Markdown fenced code blocks, and Events in Maizzle to add syntax highlighting to HTML emails."
date: 2020-02-05
---

import Alert from '~/components/Alert.vue'

<alert>This tutorial was updated on April 8, 2020 to use PostHTML syntax.</alert>

If you want to show a block of code in an HTML email _and_ have it look nice, it usually involves a lot of manual work: escaping, formatting, tokenizing, styling tokens...

With Maizzle however, we can use JavaScript libraries to do that work for us ðŸ’…

## Getting started

Let's create a new Maizzle project.

Open a terminal window and run the `new` command:

```bash
maizzle new syntax-highlight
```

That will create a `syntax-highlight` folder at your current location, clone the [Starter](https://github.com/maizzle/maizzle) in it, and install NPM dependencies for you.

OK, now open the `syntax-highlight` folder in your editor.

## Install PrismJS

First, let's install the [`posthtml-prism`](https://github.com/posthtml/posthtml-prism) plugin, which we'll use to automatically highlight our code blocks:

```bash
npm i posthtml-prism
```

Next, make sure it's used in our build process:

```js
// config.js
module.exports = {
  build: {
    posthtml: {
      plugins: [
        require('posthtml-prism')(),
      ],
    },
  }
}
```

## Add code block

Add a block of code in your template, like so:

```html
<pre>
  <code class="language-javascript">
  function foo(bar) {
    var a = 42,
      b = 'Prism';
    return a + bar(b);
  }
  </code>
</pre>
```

<alert>Notice how we added the <code>language-javascript</code> class on the <code>&lt;code&gt;</code> tag - this is required in order to get language-specific syntax highlighting.</alert>

Now run `maizzle serve` to start the development server, open `http://localhost:3000/` in a browser, and navigate to the template. 

You'll see something like this:

<pre class="mb-4"><code><span>function</span> <span>foo</span><span>(</span><span>bar</span><span>)</span> <span>{</span>
  <span>var</span> a <span>=</span> <span>42</span><span>,</span>
    b <span>=</span> <span>'Prism'</span><span>;</span>
  <span>return</span> a <span>+</span> <span>bar</span><span>(</span>b<span>)</span><span>;</span>
<span>}</span></code></pre>

If you view the source, you'll notice a lot of `<span>` tags. This means it worked, and Prism has tokenized our code block.

But it's not very pretty, is it?

## Theming

We need a Prism theme to make the code block pretty.
Choose one of the default themes, or see [prism-themes](https://github.com/PrismJS/prism-themes) for more.

For this tutorial, we'll go with a Tailwind adaptation the [Synthwave '84 Theme](https://marketplace.visualstudio.com/items?itemName=RobbOwen.synthwave-vscode).

Save [prism-synthwave84.css](https://raw.githubusercontent.com/maizzle/example-syntax-highlight/master/src/assets/css/custom/prism-synthwave84.css) to the `src/assets/css/custom` directory in your project, 
and import it in your `src/assets/css/main.css`:

```css
/* Your custom CSS resets for email */
@import "custom/reset";

/* Tailwind components that are generated by plugins */
@import "tailwindcss/components";

/**
 * @import here any custom components - classes that you'd want loaded
 * before the Tailwind utilities, so that the utilities could still
 * override them.
*/
@import "custom/prism-synthwave84";

/* Tailwind utility classes */
@import "tailwindcss/utilities";

/* Your custom utility classes */
@import "custom/utilities";
```

Next, we need to make sure that our Prism theme CSS is not purged at build time.

We can do this by wrapping its contents in special comments:

```css
/*! purgecss start ignore */
  /* contents of the prism-synthwave84.css file here... */
/*! purgecss start ignore */
```

Now, running `maizzle build` will yield the result we expected:

<pre style="padding: 24px; margin-bottom: 24px; overflow: auto; font-family: Menlo, Consolas, monospace; font-size: 16px; text-align: left; white-space: pre; background-image: linear-gradient(to bottom, #2a2139 75%, #34294f); color: #f92aad; hyphens: none; tab-size: 2; text-shadow: 0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3; word-break: normal; word-spacing: normal; word-wrap: normal; background-color: #2a2139;"><code class="language-javascript"><span style="color: #f4eee4; text-shadow: 0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;">function</span> <span style="color: #fdfdfd; text-shadow: 0 0 2px #001716, 0 0 3px #03edf975, 0 0 5px #03edf975, 0 0 8px #03edf975;">foo</span><span style="color: #cccccc;">(</span><span style="color: #f92aad;">bar</span><span style="color: #cccccc;">)</span> <span style="color: #cccccc;">{</span>
  <span style="color: #f4eee4; text-shadow: 0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;">var</span> <span style="color:#f92aad;">a</span> <span style="color: #67cdcc;">=</span> <span style="color: #e2777a;">42</span><span style="color: #cccccc;">,</span>
    <span style="color: #f92aad;">b</span> <span style="color: #67cdcc;">=</span> <span style="color: #f87c32;">'Prism'</span><span style="color: #cccccc;">;</span>
  <span style="color: #f4eee4; text-shadow: 0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;">return</span> <span style="color: #f92aad;">a</span> <span style="color: #67cdcc;">+</span> <span style="color: #fdfdfd; text-shadow: 0 0 2px #001716, 0 0 3px #03edf975, 0 0 5px #03edf975, 0 0 8px #03edf975;">bar</span><span style="color: #cccccc;">(</span><span style="color: #f92aad;">b</span><span style="color: #cccccc;">)</span><span style="color: #cccccc;">;</span>
<span style="color: #cccccc;">}</span></code></pre>

## Compatibility

Some email clients require  extra steps in order to render our code blocks properly.

### Gmail

Gmail will change our inline `white-space: pre;` to `white-space: pre-wrap;`.
This results in code wrapping, instead of showing a horizontal scrollbar.

Fix it by adding the following CSS at the beginning of `prism-synthwave84.css`:

```css
@screen all {
  pre {
    @apply whitespace-pre !important;
  }
}
```

Make sure you've registered that `all` screen with Tailwind:

```js
// tailwind.config.js
module.exports = {
  theme: {
    screens: {
      all: {'raw': 'screen'},
      sm: {'max': '600px'},
    },
  }
  // ...
}
```

### Outlook

Padding on `<pre>` doesn't work in Outlook.

We can fix this by wrapping `<pre>` inside a table that we only show in Outlook. We then style this table inline, like so:

```html
<!--[if mso]><table width="100%"><tr><td style="background: #2a2139; padding: 24px;"><![endif]-->
<pre>
  <code class="language-javascript">
  function foo(bar) {
    var a = 42,
      b = 'Prism';
    return a + bar(b);
  }
  </code>
</pre>
<!--[if mso]></td></tr></table><![endif]-->
```

## Production build

We've been working with `config.js` until now, which is configured for local development.
This means CSS isn't inlined, and most email optimizations are off.

When you're satisfied with the dev preview, run `maizzle build production` and use the template inside the `build_production/` directory for sending.

## Resources

- [Repository](https://github.com/maizzle/example-syntax-highlight) for this tutorial
- [posthtml-prism](https://github.com/posthtml/posthtml-prism) plugin
- [PrismJS](https://prismjs.com/) library
- [Synthwave '84](https://github.com/PrismJS/prism-themes/blob/master/themes/prism-synthwave84.css) theme
- Testing: [Email on Acid](https://www.emailonacid.com/), [SendTest.Email](https://sendtest.email)
